
export | python --script '

def main(input: Generator[TableSlice]) -> Generator[TableSlice]:
	""" Aggregates all `n` in the input """

	total = 0
	mean = 0
	variance = 0
	for slice in input:
		for event in slice:
			total += 1
			old_mean = mean
			x = event.x
			mean += (x - old_mean) / total
			variance += (x - old_mean)*(x - mean)

		yield {"mean": mean, "variance": variance}

'

# ---------------------------------------------------------------

export | python --script '

import requests

@schema("zeek.dns")
def main(input: Generator[TableSlice]) -> Generator[TableSlice]:
	""" Aggregates all `n` in the input """

	for slice in input:
		response = requests.get("https://api.openai.com", f"Is this an unusual event? {slice}")
		if response == "yes":
			requests.post("https://api.slack.com/webhooks", f"ALERT!!!")
		yield slice

'
