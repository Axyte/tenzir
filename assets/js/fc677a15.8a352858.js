"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[23929],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),l=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=l(n),m=a,f=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(f,p(p({ref:t},c),{},{components:n})):r.createElement(f,p({ref:t},c))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,p=new Array(o);p[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[d]="string"==typeof e?e:a,p[1]=i;for(var l=2;l<o;l++)p[l]=n[l];return r.createElement.apply(null,p)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},67160:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>v,contentTitle:()=>y,default:()=>O,frontMatter:()=>f,metadata:()=>k,toc:()=>b});var r=n(3905),a=Object.defineProperty,o=Object.defineProperties,p=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,c=(e,t,n)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,d=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&c(e,n,t[n]);if(i)for(var n of i(t))l.call(t,n)&&c(e,n,t[n]);return e},u=(e,t)=>o(e,p(t)),m=(e,t)=>{var n={};for(var r in e)s.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&i)for(var r of i(e))t.indexOf(r)<0&&l.call(e,r)&&(n[r]=e[r]);return n};const f={},y="decapsulate",k={unversionedId:"operators/transformations/decapsulate",id:"operators/transformations/decapsulate",title:"decapsulate",description:"Decapsulates packet data at link, network, and transport layer.",source:"@site/docs/operators/transformations/decapsulate.md",sourceDirName:"operators/transformations",slug:"/operators/transformations/decapsulate",permalink:"/next/operators/transformations/decapsulate",draft:!1,editUrl:"https://github.com/tenzir/tenzir/tree/main/web/docs/operators/transformations/decapsulate.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Transformations",permalink:"/next/operators/transformations/"},next:{title:"drop",permalink:"/next/operators/transformations/drop"}},v={},b=[{value:"Synopsis",id:"synopsis",level:2},{value:"Description",id:"description",level:2},{value:"VLAN Tags",id:"vlan-tags",level:3},{value:"Examples",id:"examples",level:2}],h={toc:b},g="wrapper";function O(e){var t=e,{components:n}=t,a=m(t,["components"]);return(0,r.kt)(g,u(d(d({},h),a),{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",d({},{id:"decapsulate"}),"decapsulate"),(0,r.kt)("p",null,"Decapsulates packet data at link, network, and transport layer."),(0,r.kt)("admonition",d({},{title:"Deprecated",type:"warning"}),(0,r.kt)("p",{parentName:"admonition"},"This operator will soon be removed in favor of first-class support for functions\nthat can be used in a variety of different operators and contexts.")),(0,r.kt)("h2",d({},{id:"synopsis"}),"Synopsis"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{}),"decapsulate\n")),(0,r.kt)("h2",d({},{id:"description"}),"Description"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"decapsulate")," operator proceses events of type ",(0,r.kt)("inlineCode",{parentName:"p"},"pcap.packet")," and\ndecapsulates the packet payload by extracting fields at the link, network, and\ntransport layer. The aim is not completeness, but rather exposing commonly used\nfield for analytics."),(0,r.kt)("p",null,"The operator only processes events of type ",(0,r.kt)("inlineCode",{parentName:"p"},"pcap.packet")," and emits events of\ntype ",(0,r.kt)("inlineCode",{parentName:"p"},"tenzir.packet"),"."),(0,r.kt)("h3",d({},{id:"vlan-tags"}),"VLAN Tags"),(0,r.kt)("p",null,"While decapsulating packets, ",(0,r.kt)("inlineCode",{parentName:"p"},"decapsulate")," extracts\n",(0,r.kt)("a",d({parentName:"p"},{href:"https://en.wikipedia.org/wiki/IEEE_802.1Q"}),"802.1Q")," VLAN tags into the nested\n",(0,r.kt)("inlineCode",{parentName:"p"},"vlan")," record, consisting of an ",(0,r.kt)("inlineCode",{parentName:"p"},"outer")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"inner")," field for the respective\ntags. The value of the VLAN tag corresponds to the 12-bit VLAN identifier (VID).\nSpecial values include ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," (frame does not carry a VLAN ID) and ",(0,r.kt)("inlineCode",{parentName:"p"},"0xFFF"),"\n(reserved value; sometimes wildcard match)."),(0,r.kt)("h2",d({},{id:"examples"}),"Examples"),(0,r.kt)("p",null,"Decapsulate packets from a PCAP file:"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{}),"from file /tmp/trace.pcap read pcap\n| decapsulate\n")),(0,r.kt)("p",null,"Extract packets as JSON that have the address 6.6.6.6 as source or destination,\nand destination port 5158:"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{}),"read pcap\n| decapsulate\n| where 6.6.6.6 && dport == 5158\n| write json\n")),(0,r.kt)("p",null,"Query VLAN IDs using ",(0,r.kt)("inlineCode",{parentName:"p"},"vlan.outer")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"vlan.inner"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{}),"read pcap\n| decapsulate\n| where vlan.outer > 0 || vlan.inner in [1, 2, 3]\n")),(0,r.kt)("p",null,"Filter packets by ",(0,r.kt)("a",d({parentName:"p"},{href:"https://github.com/corelight/community-id-spec"}),"Community\nID"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",d({parentName:"pre"},{}),'read pcap\n| decapsulate\n| where community_id == "1:wCb3OG7yAFWelaUydu0D+125CLM="\n')))}O.isMDXComponent=!0}}]);