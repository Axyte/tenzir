<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-VAST v3.0 plugin-docs plugin-id-default docs-doc-id-use/integrate/threatbus/understand/subscription-message-passing">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Subscriptions and Message Passing | VAST</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://vast.io/docs/VAST v3.0/use/integrate/threatbus/understand/subscription-message-passing"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="VAST v3.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-VAST v3.0"><meta data-rh="true" name="docsearch:version" content="VAST v3.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-VAST v3.0"><meta data-rh="true" property="og:title" content="Subscriptions and Message Passing | VAST"><meta data-rh="true" name="description" content="This section explains how Threat Bus manages subscriptions and describes the"><meta data-rh="true" property="og:description" content="This section explains how Threat Bus manages subscriptions and describes the"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://vast.io/docs/VAST v3.0/use/integrate/threatbus/understand/subscription-message-passing"><link data-rh="true" rel="alternate" href="https://vast.io/docs/VAST v3.0/use/integrate/threatbus/understand/subscription-message-passing" hreflang="en"><link data-rh="true" rel="alternate" href="https://vast.io/docs/VAST v3.0/use/integrate/threatbus/understand/subscription-message-passing" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BVB58VRBDH-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="VAST RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="VAST Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="VAST" href="/opensearch.xml">




<script src="https://plausible.io/js/script.js" aysnc defer="defer" data-domain="vast.io"></script><link rel="stylesheet" href="/assets/css/styles.5b0e34c0.css">
<link rel="preload" href="/assets/js/runtime~main.17c760c1.js" as="script">
<link rel="preload" href="/assets/js/main.5c2d4fb9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#f1f2f2" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Leave us <a target="_blank" rel="noopener noreferrer" href="https://github.com/tenzir/vast/stargazers">a GitHub star</a> ⭐️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/vast-logo.svg" alt="Visibility Across Space and Time" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/vast-logo.svg" alt="Visibility Across Space and Time" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">VAST</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/VAST v3.0/about">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/changelog">Changelog</a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a></div><div class="navbar__items navbar__items--right"><a href="https://vast.io/discord" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="Discord"></a><a href="https://github.com/tenzir/vast" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/VAST v3.0/about">VAST v3.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/use/integrate/threatbus/understand/subscription-message-passing">Next</a></li><li><a class="dropdown__link" href="/docs/use/integrate/threatbus/understand/subscription-message-passing">VAST v3.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/VAST v3.0/use/integrate/threatbus/understand/subscription-message-passing">VAST v3.0</a></li></ul></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/VAST v3.0/about">About</a><button aria-label="Toggle the collapsible sidebar category &#x27;About&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/about/why-vast">Why VAST</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/about/target-audience">Target Audience</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/about/vision">Vision</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/VAST v3.0/about/use-cases">Use Cases</a><button aria-label="Toggle the collapsible sidebar category &#x27;Use Cases&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/VAST v3.0/try">Try</a><button aria-label="Toggle the collapsible sidebar category &#x27;Try&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/VAST v3.0/setup">Setup</a><button aria-label="Toggle the collapsible sidebar category &#x27;Setup&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/VAST v3.0/use">Use</a><button aria-label="Toggle the collapsible sidebar category &#x27;Use&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/run">Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/import">Import</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/export">Export</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/transform">Transform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/introspect">Introspect</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/VAST v3.0/use/detect/match-threat-intel">Detect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/VAST v3.0/use/integrate/rest-api">Integrate</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/integrate/rest-api">REST API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/integrate/python">Python</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus">Threat Bus</a><button aria-label="Toggle the collapsible sidebar category &#x27;Threat Bus&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus/install">Install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus/configure">Configure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus/deploy">Deploy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus/use">Use</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus/understand/design-goals">Understand</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus/understand/design-goals">Design Goals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus/understand/subscription-message-passing">Subscriptions and Message Passing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus/understand/snapshotting">Snapshotting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/VAST v3.0/use/integrate/threatbus/understand/plugins">Plugins</a><button aria-label="Toggle the collapsible sidebar category &#x27;Plugins&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/VAST v3.0/understand">Understand</a><button aria-label="Toggle the collapsible sidebar category &#x27;Understand&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/VAST v3.0/contribute">Contribute</a><button aria-label="Toggle the collapsible sidebar category &#x27;Contribute&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/VAST v3.0/develop">Develop</a><button aria-label="Toggle the collapsible sidebar category &#x27;Develop&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->VAST<!-- --> <b>VAST v3.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/use/integrate/threatbus/understand/subscription-message-passing">latest version</a></b> (<!-- -->VAST v3.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/VAST v3.0/use"><span itemprop="name">Use</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Integrate</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/VAST v3.0/use/integrate/threatbus"><span itemprop="name">Threat Bus</span></a><meta itemprop="position" content="3"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Understand</span><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Subscriptions and Message Passing</span><meta itemprop="position" content="5"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: VAST v3.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Subscriptions and Message Passing</h1><p>This section explains how Threat Bus manages subscriptions and describes the
message passing flow between subscribers. The document addresses developers who
are interested in contributing to Threat Bus or otherwise want to learn about
the runtime internals.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="separation-of-concerns">Separation of Concerns<a href="#separation-of-concerns" class="hash-link" aria-label="Direct link to Separation of Concerns" title="Direct link to Separation of Concerns">​</a></h2><p>Threat Bus and all plugins are implemented with python
<a href="https://docs.python.org/3/library/threading.html" target="_blank" rel="noopener noreferrer">threads</a> and thread-safe,
synchronized <a href="https://docs.python.org/3/library/queue.html" target="_blank" rel="noopener noreferrer">queues</a>. The main
loop of Threat Bus must never be blocked. All plugins should implement the
<a href="https://github.com/tenzir/threatbus/blob/master/threatbus/stoppable_worker.py" target="_blank" rel="noopener noreferrer">StoppableWorker</a>
base class to model busy work. Implementing that class also facilitates a
graceful shutdown.</p><p>As plugins run in their own threads and are not aware of each other, Threat Bus
uses queues to enable communication between them. On start-up, Threat Bus
creates one <strong>global queue for incoming messages</strong>. Let&#x27;s call it <code>inq</code>. Threat
Bus passes a reference to this queue to all installed plugins <!-- -->—<!-- --> backbone
and application plugins alike. Per convention, only application plugins write to
the <code>inq</code>, while backbone plugins consume messages from it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="subscription-flow">Subscription Flow<a href="#subscription-flow" class="hash-link" aria-label="Direct link to Subscription Flow" title="Direct link to Subscription Flow">​</a></h2><p>Threat Bus provides two callbacks to all application plugins for subscribing and
unsubscribing apps. You can find their implementation in the
<a href="https://github.com/tenzir/threatbus/blob/master/threatbus/threatbus.py" target="_blank" rel="noopener noreferrer"><code>threatbus.py</code></a>
entry point of the Threat Bus application. The signature of the callbacks looks
as follows.</p><div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> JoinableQueue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> time_delta</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> timedelta </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">topic</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> JoinableQueue</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Applications (e.g., a Zeek instance) un/subscribe from/to Threat Bus via an
application plugin (e.g., <code>threatbus-zeek</code> offers a <code>broker</code> endpoint for Zeek
instances to connect with). All communication between application and app plugin
uses an <strong>app-specific</strong> message format. In our example, Zeek sends <code>broker</code>
messages.</p><p>The application plugin transforms received messages from the app-specific
message format and invokes the corresponding callback for un/subscribing.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This message format mapping is the same for all kinds of messages exchanged
between apps and app plugins, be it un/subscriptions or security content.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subscriptions">Subscriptions<a href="#subscriptions" class="hash-link" aria-label="Direct link to Subscriptions" title="Direct link to Subscriptions">​</a></h3><p>Subscribing requires passing a topic and an optional integer for requesting a
<a href="/docs/VAST v3.0/use/integrate/threatbus/understand/snapshotting">snapshot</a> of historic indicators. Application plugins create a
new <strong>queue for every subscription</strong> they receive from an app. Let&#x27;s call that
queue <code>outq_1</code>.</p><p>Backbones provision incoming messages from the global <code>inq</code> to all subscribers
(all the many <code>outq_n</code>s). But how do backbones become aware of new queues?</p><p>This is done via the <code>subscribe</code> callback. Application plugins pass the
subscribed topic along with the newly created <code>outq_x</code> to Threat Bus. Threat Bus
then instructs all registered backbones to provision messages for the
requested topic to the new queue (<code>outq_1</code> in our example).</p><p>Once subscribed, application plugins read from the <code>outq</code>s they created. The
plugins are responsible to forward all messages that appear in any given <code>outq</code>
to the subscribed app. How that is done, for example over the wire, is
implementation specific logic and handled by the plugin (e.g., via <code>broker</code> to a
Zeek instance or via ZeroMQ to VAST).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unsubscriptions">Unsubscriptions<a href="#unsubscriptions" class="hash-link" aria-label="Direct link to Unsubscriptions" title="Direct link to Unsubscriptions">​</a></h3><p>Unsubscription works just as subscription, via a callback to Threat Bus. A
subscribed app, e.g., a Zeek instance, unsubscribes at the responsible app
plugin using the app-specific format (<code>broker</code> in this case). The plugin parses
the request, extracts the topic the app wishes to unsubscribe from, and forwards
that topic along with the corresponding <code>outq_x</code> of the subscriber to Threat Bus
via the <code>unsubscribe()</code> callback shown above. Threat Bus then instructs all
backbones to forget about the said <code>outq_x</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="message-passing">Message Passing<a href="#message-passing" class="hash-link" aria-label="Direct link to Message Passing" title="Direct link to Message Passing">​</a></h2><p>This section outlines how messages flow through Threat Bus on the example of two
already subscribed applications -- the
<a href="https://github.com/OpenCTI-Platform/connectors/tree/master/threatbus" target="_blank" rel="noopener noreferrer">OpenCTI connector</a>
and <a href="https://zeek.org/" target="_blank" rel="noopener noreferrer">Zeek</a>.</p><p>In our example, Threat Bus is equipped with three plugins:</p><ul><li><code>threatbus-zeek</code> for communicating with Zeek instances via <code>broker</code>.</li><li><code>threatbus-zmq</code> for communicating via ZeroMQ (i.e., with the
<code>opencti-connector</code>).</li><li><code>threatbus-inmem</code> for having a simple, in-memory backbone.</li></ul><p>A Zeek instance has already subscribed to Threat Bus via the <code>threatbus-zeek</code>
plugin&#x27;s <code>broker</code> endpoint. It is subscribed to the topic <code>stix2/indicator</code> and
an appropriate <code>outq</code> is already created (see the <a href="#subscription-flow">Subscription
Flow</a> above).</p><p>Let&#x27;s assume the <code>opencti-connector</code> sends a STIX-2 indicator to Threat Bus via
ZeroMQ. The message arrives at the <code>threatbus-zmq</code> plugin. Format conversion
is not required, because the message is already in STIX-2 format. The plugin now
puts this message in the global <code>inq</code>.</p><p>In another thread, the <code>threatbus-inmem</code> plugin continuously reads from the
<code>inq</code>. It is also aware of the subscription from the Zeek instance for the topic
<code>stix2/indicator</code>. Because the incoming message is of exactly that type, the
backbone clones the message from the <code>inq</code> and puts it into the <code>outq</code>.</p><p>The <code>threatbus-zeek</code> plugin (again in another thread) continuously monitors all
<code>outq</code>s of its subscribed Zeek instances. Once the new message arrives in the
<code>outq</code> <code>threatbus-zeek</code> maps the STIX-2 indicator to a <code>broker</code> compatible
format before sending it out to the appropriate Zeek instance.</p><p>Finally, the Zeek instance receives the message and can ingest it into its intel
framework. Should Zeek generate a sighting now, the message would similarly flow
all the way back into OpenCTI, just reversing the flow.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/tenzir/vast/tree/main/web/versioned_docs/version-VAST v3.0/use/integrate/threatbus/understand/subscription-message-passing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/VAST v3.0/use/integrate/threatbus/understand/design-goals"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Design Goals</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/VAST v3.0/use/integrate/threatbus/understand/snapshotting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Snapshotting</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#separation-of-concerns" class="table-of-contents__link toc-highlight">Separation of Concerns</a></li><li><a href="#subscription-flow" class="table-of-contents__link toc-highlight">Subscription Flow</a><ul><li><a href="#subscriptions" class="table-of-contents__link toc-highlight">Subscriptions</a></li><li><a href="#unsubscriptions" class="table-of-contents__link toc-highlight">Unsubscriptions</a></li></ul></li><li><a href="#message-passing" class="table-of-contents__link toc-highlight">Message Passing</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/setup">Setup</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/use">Use</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/understand">Understand</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contribute">Contribute</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/develop">Develop</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/discord">Discord</a></li><li class="footer__item"><a href="https://github.com/tenzir/vast" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/tenzir_company" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/tenzir" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/newsletter">Newsletter</a></li></ul></div><div class="col footer__col"><div class="footer__title">VAST</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">Changelog</a></li><li class="footer__item"><a class="footer__link-item" href="/roadmap">Roadmap</a></li><li class="footer__item"><a class="footer__link-item" href="/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-statement">Privacy Statement</a></li></ul></div><div class="col footer__col"><div class="footer__title">Tenzir</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/vast-and-tenzir">VAST and Tenzir</a></li><li class="footer__item"><a href="https://tenzir.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tenzir.com/request-demo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Request Demo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tenzir.com/contact-us" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tenzir.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Tenzir GmbH.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.17c760c1.js"></script>
<script src="/assets/js/main.5c2d4fb9.js"></script>
</body>
</html>